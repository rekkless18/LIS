# 数据库设计总览（Supabase/PostgreSQL）

## 约定
- 命名规范：全部使用小写 `snake_case`
- 主键：`id`（UUID），含 `created_at`、`updated_at`（timestamp）
- 关联字段统一以 `_id` 结尾；状态与类型采用受限枚举（text/enum）

## 权限管理
- users
  - id, account, name, user_type, email, phone, status, last_login_at, last_password_change_at
- roles
  - id, role_code, role_name, role_type, status
- permissions
  - id, perm_key, perm_name, parent_key, route_path, enabled
- user_roles
  - id, user_id, role_id
- role_permissions
  - id, role_id, permission_id

## 系统管理
- system_params
  - id, login_system_name, menu_system_name, version

## 后台配置
- customers
  - id, customer_code, customer_name, customer_type, region, status
- products
  - id, product_code, product_name, product_type, status
- test_items
  - id, item_code, item_name, item_type, judgement_type, status
- product_test_items
  - id, product_id, test_item_id
- packages
  - id, package_code, package_name, package_type, status
- package_items
  - id, package_id, product_id, sample_type
- report_templates
  - id, template_code, template_name, template_type, product_type, status, version, file_url
- tech_routes
  - id, route_code, route_name, inspection_type, tech_category, status, description
- tech_route_steps
  - id, route_id, step_order, step_name, method, params
- experiment_configs
  - id, experiment_code, experiment_name, experiment_type, method, enabled
- approval_flows
  - id, flow_code, flow_name, approval_type, applicable_service, enabled
- approval_flow_nodes
  - id, flow_id, node_order, node_name, approval_role, condition

## 订单管理
- orders
  - id, order_no, order_type, customer_id, contract_no, urgent_type, urgent_reason, status, created_by
- order_items
  - id, order_id, product_id, package_id, sample_count, delivery_requirements

## 样本管理
- samples
  - id, sample_no, original_sample_no, sample_type, order_id, patient_name, patient_phone, patient_id_type, patient_id,
    birth_date, age_type, age, month_age, gender, exception_status, storage_location, storage_box_id, status, received_at

## 物流管理
- logistics
  - id, logistics_no, order_id, company, status, shipped_at, created_by

## 实验管理（普检/特检/质谱）
- routine_tasks
  - id, sample_id, product_id, status, start_time, end_time, audit_time, audit_status, device
- special_preprocess_tasks
  - id, sample_id, product_id, status, start_time, end_time, method, operator, qc_result, device_station
- special_prerun_tasks
  - id, sample_id, product_id, status, start_time, end_time, operator, qc_result
- special_sequencing_runs
  - id, batch_no, sample_id, device, status, start_time, end_time, logs_url
- special_bioinfo_jobs
  - id, sample_id, pipeline, status, start_time, end_time, result_url, logs_url, audit_status
- special_qpcr_tasks
  - id, sample_id, product_id, status, start_time, end_time, cq_value, curve_data_url, result_interpretation
- special_audit_records
  - id, sample_id, product_id, status, auditor_id, completed_at, decision, reason
- special_exception_tasks
  - id, sample_id, product_id, exception_status, start_time, end_time, retest_time, device, operator, reason
- ms_experiments
  - id, sample_id, product_id, status, device, start_time, end_time
- ms_audits
  - id, sample_id, product_id, status, auditor_id, completed_at, decision, reason
- ms_exceptions
  - id, sample_id, product_id, exception_status, start_time, end_time, retest_time, device

## 报告管理
- reports
  - id, report_no, order_id, sample_id, status, audit_status, audit_time, download_count, preview_url

## 库存管理
- materials
  - id, material_no, material_name, manufacturer, batch_no, created_date, valid_period, threshold_level, quantity, status

## 审批管理
- approvals
  - id, approval_no, approval_type, status, applicant_id, created_at, content, approval_flow_id
- approval_actions
  - id, approval_id, action, reason, actor_id, acted_at

## 实验室管理
- environments
  - id, room_no, room_location, status, protection_level, temperature, humidity, pressure, updated_at
- equipment
  - id, device_no, device_name, device_type, status, location, manufacturer, purchase_date, last_maintenance_date, scrap_date, owner_id

## 备注
- 所有列表页的“状态/类型枚举”与“时间字段”均与设计文档保持一致，可在后续落地阶段细化为枚举表或约束。
- 审批流、技术路线、实验配置与报告模板等配置类表均预留“描述/参数”字段以便后续扩展。
